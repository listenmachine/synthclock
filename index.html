<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hour Drift — Minimal Time Gradient</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --fg: #eaeaea;
    --panel: rgb(28 28 30 / 88%);
    --shadow: 0 8px 24px rgb(0 0 0 / 35%);
  }
  html,body{height:100%}
  body{
    margin:0; height:100%;
    background:#0b0b0c; /* will be replaced by gradient */
    color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    transition: background .6s ease;
  }
  /* Top-right minimal controls */
  .topbar{
    position:fixed; top:18px; right:18px; display:flex; gap:10px; z-index:5;
    filter: drop-shadow(0 6px 18px rgb(0 0 0 / .35));
  }
  .btn{
    background:#1b1b1d; color:var(--fg); border:1px solid #333; padding:10px 14px;
    border-radius:14px; cursor:pointer; font-weight:600; letter-spacing:.2px;
  }
  .btn:hover{ filter:brightness(1.1) }
  .brand{
    position:fixed; left:18px; top:20px; font-weight:700; opacity:.85;
    text-shadow: 0 2px 12px rgb(0 0 0 / .45);
  }
  .hint{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
    font-size:.9rem; opacity:.7; text-shadow: 0 2px 12px rgb(0 0 0 / .45);
  }
  /* Settings */
  dialog{
    border:none; border-radius:22px; padding:0; background:var(--panel); color:var(--fg);
    width:min(760px, 92vw); box-shadow: var(--shadow);
  }
  dialog::backdrop{ background: rgb(0 0 0 / .45) }
  .panel{ padding:18px }
  .panel h2{ margin:4px 0 14px; font-size:1.05rem; letter-spacing:.3px; }
  .grid{ display:grid; grid-template-columns: repeat(6,minmax(0,1fr)); gap:10px; }
  .sw{ background:#141416; border:1px solid #2d2e33; border-radius:12px; padding:8px; display:flex; flex-direction:column; align-items:center; gap:6px; }
  .sw label{ font-size:.8rem; opacity:.8; font-weight:600 }
  .sw input[type="color"]{ width:100%; height:38px; border:none; background:transparent; border-radius:10px; cursor:pointer; }
  .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:12px; flex-wrap:wrap }
  .pill{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#17171a; border:1px solid #2b2c31; font-weight:600 }
  @media (max-width:760px){ .grid{ grid-template-columns: repeat(3,minmax(0,1fr)); } }
</style>
</head>
<body>
  <div class="brand">Hour Drift</div>
  <div class="topbar" id="controls">
    <button class="btn" id="open">Colours</button>
    <button class="btn" id="hide">Hide</button>
  </div>
  <div class="hint">hour → next hour • press <b>H</b> to toggle controls</div>

  <!-- Settings -->
  <dialog id="panel">
    <div class="panel">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <h2>Hour colours (1–12)</h2>
        <button class="btn" id="close">Close</button>
      </div>
      <div class="grid" id="swGrid"></div>
      <div class="row">
        <label class="pill"><input type="checkbox" id="twelve" checked /> 12-hour time</label>
        <div style="display:flex; gap:10px; align-items:center;">
          <button class="btn" id="reset">Reset</button>
          <button class="btn" id="exportBtn">Export</button>
          <button class="btn" id="importBtn">Import</button>
        </div>
      </div>
      <p style="opacity:.75; margin-top:10px">The background is a left→right gradient from the current hour colour to the next hour colour. As minutes pass, the gradient’s midpoint slides slowly from the right edge towards the left.</p>
    </div>
  </dialog>

<script>
/* ---------- Minimal hour→next-hour gradient ---------- */
const DEFAULTS = {
  twelve: true,
  // 1..12 default palette (tweak freely)
  hours: [
    '#ff5a5f', // 1
    '#f7b500', // 2
    '#4bd964', // 3
    '#34c0ff', // 4
    '#9b59ff', // 5
    '#ff9bd3', // 6
    '#ff7e33', // 7
    '#16c6a8', // 8
    '#c6ff34', // 9
    '#d96a7f', // 10
    '#ff5a5f', // 11
    '#e2902f'  // 12
  ]
};

const store = {
  load(){ try{ return JSON.parse(localStorage.getItem('hourDrift')) || DEFAULTS }catch{ return DEFAULTS } },
  save(s){ localStorage.setItem('hourDrift', JSON.stringify(s)); }
};
let state = store.load();

/* ---------- DOM ---------- */
const controls = document.getElementById('controls');
const openBtn  = document.getElementById('open');
const hideBtn  = document.getElementById('hide');
const panel    = document.getElementById('panel');
const closeBtn = document.getElementById('close');
const grid     = document.getElementById('swGrid');
const twelve   = document.getElementById('twelve');

/* ---------- UI ---------- */
function buildSwatches(){
  grid.innerHTML = '';
  for(let i=1;i<=12;i++){
    const wrap = document.createElement('div'); wrap.className='sw';
    const lab = document.createElement('label'); lab.textContent = i;
    const inp = document.createElement('input'); inp.type='color'; inp.value = state.hours[i-1];
    inp.addEventListener('input', e => { state.hours[i-1]=e.target.value; store.save(state); });
    wrap.append(lab, inp); grid.appendChild(wrap);
  }
}
openBtn.onclick = ()=>{ buildSwatches(); twelve.checked=!!state.twelve; panel.showModal(); };
closeBtn.onclick = ()=> panel.close();
hideBtn.onclick = ()=> controls.style.display='none';
document.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='h'){ controls.style.display = controls.style.display==='none' ? '' : 'none'; }});
twelve.onchange = e=>{ state.twelve=!!e.target.checked; store.save(state); };

document.getElementById('reset').onclick = ()=>{
  state = JSON.parse(JSON.stringify(DEFAULTS));
  store.save(state); buildSwatches();
};
document.getElementById('exportBtn').onclick = ()=>{
  const blob = new Blob([JSON.stringify(state)], {type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='hour-drift-colours.json'; a.click(); URL.revokeObjectURL(a.href);
};
document.getElementById('importBtn').onclick = ()=>{
  const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json';
  inp.onchange=()=>{ const f=inp.files[0]; if(!f) return; const r=new FileReader();
    r.onload=()=>{ try{ const obj=JSON.parse(r.result); if(obj.hours) state.hours=obj.hours.slice(0,12); if(typeof obj.twelve==='boolean') state.twelve=obj.twelve; store.save(state); buildSwatches(); }catch{} };
    r.readAsText(f);
  }; inp.click();
};

/* ---------- Time → gradient ---------- */
function h12(h){ const v = h % 12; return v===0 ? 12 : v; }
function hourColor(hour){ return state.hours[(hour-1+12)%12] || '#ffffff'; }

function update(){
  const now = new Date();
  // current hour in chosen format (1..12)
  const cur = state.twelve ? h12(now.getHours()) : h12(now.getHours()); // we reuse 12-color mapping either way
  const next = cur % 12 + 1;

  const cNow  = hourColor(cur);
  const cNext = hourColor(next);

  // Hour progress (0 at :00 → 1 at :59.999)
  const t = (now.getMinutes() + now.getSeconds()/60 + now.getMilliseconds()/60000) / 60;

  // Midpoint moves from right (near 100%) → left (near 0%)
  const p = (1 - t) * 100;             // center position in %
  const band = 22;                      // width of blend band in %
  const p1 = Math.max(0, Math.min(100, p - band/2));
  const p2 = Math.max(0, Math.min(100, p + band/2));

  // Build CSS gradient with a smooth blend band
  const grad = `linear-gradient(90deg,
                 ${cNow} 0%,
                 ${cNow} ${p1}%,
                 ${cNext} ${p2}%,
                 ${cNext} 100%)`;
  document.body.style.backgroundImage = grad;

  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
