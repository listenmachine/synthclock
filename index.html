<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hour Drift — Minimal Time Gradient</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --fg: #eaeaea;
    --panel: rgb(28 28 30 / 88%);
    --shadow: 0 8px 24px rgb(0 0 0 / 35%);
    --grain-opacity: .14; /* controlled by slider */
  }
  html,body{height:100%}
  body{
    margin:0; height:100%;
    background:#0b0b0c; /* replaced by gradient */
    color:var(--fg); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    transition: background .6s ease;
  }
  /* Grain overlay */
  .grain{
    position:fixed; inset:0; z-index:2; pointer-events:none;
    mix-blend-mode: soft-light;           /* gentle contrast lift */
    opacity: var(--grain-opacity);
    background-repeat: repeat;
    background-size: auto;
  }
  /* Top-right minimal controls */
  .topbar{
    position:fixed; top:18px; right:18px; display:flex; gap:10px; z-index:5;
    filter: drop-shadow(0 6px 18px rgb(0 0 0 / .35));
  }
  .btn{
    background:#1b1b1d; color:var(--fg); border:1px solid #333; padding:10px 14px;
    border-radius:14px; cursor:pointer; font-weight:600; letter-spacing:.2px;
  }
  .btn:hover{ filter:brightness(1.1) }
  .brand{
    position:fixed; left:18px; top:20px; font-weight:700; opacity:.85;
    text-shadow: 0 2px 12px rgb(0 0 0 / .45); z-index:5;
  }
  .hint{
    position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
    font-size:.9rem; opacity:.7; text-shadow: 0 2px 12px rgb(0 0 0 / .45); z-index:5;
  }
  /* Settings */
  dialog{
    border:none; border-radius:22px; padding:0; background:var(--panel); color:var(--fg);
    width:min(760px, 92vw); box-shadow: var(--shadow);
  }
  dialog::backdrop{ background: rgb(0 0 0 / .45) }
  .panel{ padding:18px }
  .panel h2{ margin:4px 0 14px; font-size:1.05rem; letter-spacing:.3px; }
  .grid{ display:grid; grid-template-columns: repeat(6,minmax(0,1fr)); gap:10px; }
  .sw{ background:#141416; border:1px solid #2d2e33; border-radius:12px; padding:8px; display:flex; flex-direction:column; align-items:center; gap:6px; }
  .sw label{ font-size:.8rem; opacity:.8; font-weight:600 }
  .sw input[type="color"]{ width:100%; height:38px; border:none; background:transparent; border-radius:10px; cursor:pointer; }
  .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:12px; flex-wrap:wrap }
  .pill{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#17171a; border:1px solid #2b2c31; font-weight:600 }
  .range{ display:flex; align-items:center; gap:10px; }
  .range input{ width:200px; }
  @media (max-width:760px){ .grid{ grid-template-columns: repeat(3,minmax(0,1fr)); } .range input{ width:150px; } }
</style>
</head>
<body>
  <div class="brand">Hour Drift</div>
  <div class="topbar" id="controls">
    <button class="btn" id="open">Colours</button>
    <button class="btn" id="hide">Hide</button>
  </div>
  <div class="hint">hour → next hour • press <b>H</b> to toggle controls</div>

  <!-- Grain overlay -->
  <div class="grain" id="grain" aria-hidden="true"></div>

  <!-- Settings -->
  <dialog id="panel">
    <div class="panel">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <h2>Hour colours (1–12)</h2>
        <button class="btn" id="close">Close</button>
      </div>
      <div class="grid" id="swGrid"></div>

      <div class="row">
        <label class="pill"><input type="checkbox" id="twelve" checked /> 12-hour time</label>
        <div class="range">
          <label class="pill">Grain <span id="grainVal">14%</span></label>
          <input type="range" id="grainAmt" min="0" max="30" value="14" />
          <label class="pill"><input type="checkbox" id="grainAnim" checked /> Animate</label>
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
          <button class="btn" id="reset">Reset</button>
          <button class="btn" id="exportBtn">Export</button>
          <button class="btn" id="importBtn">Import</button>
        </div>
      </div>

      <p style="opacity:.75; margin-top:10px">
        The background is a left→right gradient from the current hour colour to the next hour colour.
        As minutes pass, the gradient’s midpoint slides slowly from the right edge towards the left.
        The grain helps break banding and adds a soft, film-like texture.
      </p>
    </div>
  </dialog>

<script>
/* ---------- Minimal hour→next-hour gradient with grain ---------- */
const DEFAULTS = {
  twelve: true,
  hours: [
    '#ff5a5f', '#f7b500', '#4bd964', '#34c0ff', '#9b59ff', '#ff9bd3',
    '#ff7e33', '#16c6a8', '#c6ff34', '#d96a7f', '#ff5a5f', '#e2902f'
  ],
  grainAmt: 14,   // 0–30 (% opacity)
  grainAnim: true // animate noise (refresh every ~250ms)
};

const store = {
  load(){ try{ return JSON.parse(localStorage.getItem('hourDrift')) || DEFAULTS }catch{ return DEFAULTS } },
  save(s){ localStorage.setItem('hourDrift', JSON.stringify(s)); }
};
let state = store.load();

/* ---------- DOM ---------- */
const controls = document.getElementById('controls');
const openBtn  = document.getElementById('open');
const hideBtn  = document.getElementById('hide');
const panel    = document.getElementById('panel');
const closeBtn = document.getElementById('close');
const grid     = document.getElementById('swGrid');
const twelve   = document.getElementById('twelve');

const grainDiv   = document.getElementById('grain');
const grainAmtEl = document.getElementById('grainAmt');
const grainVal   = document.getElementById('grainVal');
const grainAnimEl= document.getElementById('grainAnim');

/* ---------- UI ---------- */
function buildSwatches(){
  grid.innerHTML = '';
  for(let i=1;i<=12;i++){
    const wrap = document.createElement('div'); wrap.className='sw';
    const lab = document.createElement('label'); lab.textContent = i;
    const inp = document.createElement('input'); inp.type='color'; inp.value = state.hours[i-1];
    inp.addEventListener('input', e => { state.hours[i-1]=e.target.value; store.save(state); });
    wrap.append(lab, inp); grid.appendChild(wrap);
  }
}
openBtn.onclick = ()=>{ buildSwatches(); twelve.checked=!!state.twelve; grainAmtEl.value=state.grainAmt; grainVal.textContent = state.grainAmt + '%'; grainAnimEl.checked=!!state.grainAnim; panel.showModal(); };
closeBtn.onclick = ()=> panel.close();
hideBtn.onclick = ()=> controls.style.display='none';
document.addEventListener('keydown', e=>{ if(e.key.toLowerCase()==='h'){ controls.style.display = controls.style.display==='none' ? '' : 'none'; }});
twelve.onchange = e=>{ state.twelve=!!e.target.checked; store.save(state); };

document.getElementById('reset').onclick = ()=>{
  state = JSON.parse(JSON.stringify(DEFAULTS));
  store.save(state); buildSwatches(); applyGrain();
};
document.getElementById('exportBtn').onclick = ()=>{
  const blob = new Blob([JSON.stringify(state)], {type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='hour-drift-colours.json'; a.click(); URL.revokeObjectURL(a.href);
};
document.getElementById('importBtn').onclick = ()=>{
  const inp=document.createElement('input'); inp.type='file'; inp.accept='application/json';
  inp.onchange=()=>{ const f=inp.files[0]; if(!f) return; const r=new FileReader();
    r.onload=()=>{ try{ const obj=JSON.parse(r.result);
      if(obj.hours) state.hours=obj.hours.slice(0,12);
      if(typeof obj.twelve==='boolean') state.twelve=obj.twelve;
      if(typeof obj.grainAmt==='number') state.grainAmt=Math.max(0,Math.min(30, obj.grainAmt));
      if(typeof obj.grainAnim==='boolean') state.grainAnim=obj.grainAnim;
      store.save(state); buildSwatches(); applyGrain();
    }catch{} }; r.readAsText(f);
  }; inp.click();
};
grainAmtEl.oninput = e=>{ state.grainAmt = parseInt(e.target.value||0,10); grainVal.textContent = state.grainAmt + '%'; store.save(state); applyGrain(); };
grainAnimEl.onchange = e=>{ state.grainAnim = !!e.target.checked; store.save(state); applyGrain(); };

/* ---------- Grain generator (tile-based, lightweight) ---------- */
let grainTimer = null;
function renderGrain(){
  const size = 128;
  if(!renderGrain.canvas){
    const c = document.createElement('canvas');
    c.width = size; c.height = size;
    renderGrain.canvas = c; renderGrain.ctx = c.getContext('2d', { willReadFrequently: true });
  }
  const c = renderGrain.canvas, ctx = renderGrain.ctx;
  const id = ctx.createImageData(size, size);
  const data = id.data;
  for(let i=0;i<data.length;i+=4){
    const v = (Math.random()*255)|0;         // white noise
    data[i]=data[i+1]=data[i+2]=v; data[i+3]=255;
  }
  ctx.putImageData(id,0,0);
  grainDiv.style.backgroundImage = `url(${c.toDataURL()})`;
}
function applyGrain(){
  document.documentElement.style.setProperty('--grain-opacity', (state.grainAmt/100).toString());
  grainDiv.style.display = state.grainAmt>0 ? 'block' : 'none';
  renderGrain();
  if(grainTimer){ clearInterval(grainTimer); grainTimer = null; }
  if(state.grainAnim && state.grainAmt>0){
    grainTimer = setInterval(renderGrain, 250); // gentle shimmer
  }
}

/* ---------- Time → gradient ---------- */
function h12(h){ const v = h % 12; return v===0 ? 12 : v; }
function hourColor(hour){ return state.hours[(hour-1+12)%12] || '#ffffff'; }

function update(){
  const now = new Date();
  const cur = h12(now.getHours());           // map to 1..12
  const next = cur % 12 + 1;

  const cNow  = hourColor(cur);
  const cNext = hourColor(next);

  // Hour progress (0 at :00 → 1 at :59.999)
  const t = (now.getMinutes() + now.getSeconds()/60 + now.getMilliseconds()/60000) / 60;

  // Midpoint moves from right (100%) → left (0%)
  const p = (1 - t) * 100;      // center position in %
  const band = 22;              // width of blend band in %
  const p1 = Math.max(0, Math.min(100, p - band/2));
  const p2 = Math.max(0, Math.min(100, p + band/2));

  // Build gradient with smooth blend band
  const grad = `linear-gradient(90deg,
                 ${cNow} 0%,
                 ${cNow} ${p1}%,
                 ${cNext} ${p2}%,
                 ${cNext} 100%)`;
  document.body.style.backgroundImage = grad;

  requestAnimationFrame(update);
}

/* ---------- Boot ---------- */
buildSwatches();
applyGrain();
update();
</script>
</body>
</html>
