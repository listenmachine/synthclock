<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Synaesthesia Clock</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg: #0b0b0c;
      --fg: #eaeaea;
      --muted: #8a8a8a;
      --panel: rgb(28 28 30 / 88%);
      --tile-size: min(12vw, 96px);
      --gap: clamp(8px, 1.5vw, 16px);
      --radius: 22px;
      --ring-size: min(72vmin, 560px);
      --ring-thickness: 22px;
      --shadow: 0 8px 24px rgb(0 0 0 / 35%);
    }

    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      display:grid; place-items:center;
    }

    /* ----- Layout ----- */
    .wrap{ width: min(1100px, 94vw); }
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin: 28px auto 18px; max-width: 1100px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; opacity:.9;
      letter-spacing:.5px; font-weight:600; font-size:1rem;
    }
    .brand .dot{ width:10px; height:10px; border-radius:50%; background:var(--fg); filter:blur(.2px); }

    .controls{ display:flex; align-items:center; gap:10px; }
    .btn{ 
      background: #1b1b1d; color:var(--fg); border:1px solid #333; 
      padding:10px 14px; border-radius:14px; cursor:pointer; 
      box-shadow: var(--shadow);
      font-weight:600; letter-spacing:.2px; transition: .2s ease;
    }
    .btn:hover{ filter:brightness(1.1) }

    .clock{
      display:grid; justify-content:center; align-items:center;
      gap: var(--gap); margin: 24px auto 18px;
    }

    /* Modes */
    .tiles{ grid-template-columns: repeat(6, var(--tile-size)); }
    .tile{
      width: var(--tile-size); height: var(--tile-size);
      border-radius: var(--radius);
      box-shadow: inset 0 0 0 1.5px rgb(255 255 255 / 7%), var(--shadow);
      position:relative; overflow:hidden;
      transform: translateZ(0);
    }
    .tile::after{ /* subtle glass */
      content:""; position:absolute; inset:0; 
      background: linear-gradient(180deg, rgb(255 255 255 / .04), transparent 30%, transparent 70%, rgb(0 0 0 / .15));
      pointer-events:none;
    }
    .tile-num{ position:absolute; inset:auto 8px 8px auto; 
      width:28px; height:28px; border-radius:8px; 
      background: rgb(0 0 0 / .22); color: rgb(255 255 255 / .75);
      display:grid; place-items:center; font-weight:700; font-size:.95rem;
      opacity:0; transition: opacity .2s ease;
    }
    .show-digits .tile-num{ opacity:1 }

    /* Stripes mode: 6 vertical bars that fill the viewport height */
    .stripes{ grid-template-columns: repeat(6, 1fr); width:min(1100px, 92vw); height:min(40vh, 340px); }
    .stripe{ border-radius: 18px; position:relative; overflow:hidden; box-shadow: var(--shadow); }
    .stripe::after{ content:""; position:absolute; inset:0; background: linear-gradient(180deg, rgb(255 255 255 / .06), transparent 28%, transparent 75%, rgb(0 0 0 / .18));}

    /* Ring mode: 3 blended rings for HH, MM, SS from their two digits */
    .ring-wrap{ position:relative; width:var(--ring-size); height:var(--ring-size); margin-inline:auto; }
    .ring{ position:absolute; inset:0; border-radius:50%; 
      mask: radial-gradient(circle at center, transparent calc(50% - var(--ring-thickness)), black calc(50% - var(--ring-thickness) + 1px));
      box-shadow: var(--shadow);
    }
    .ring.hh{ transform: scale(1); }
    .ring.mm{ transform: scale(.85); }
    .ring.ss{ transform: scale(.70); }

    .legend{ display:flex; gap:10px; align-items:center; justify-content:center; color:var(--muted); font-size:.9rem; margin-top:10px }
    .legend .swatch{ width:10px; height:10px; border-radius:50%; box-shadow: 0 0 0 1px rgb(255 255 255 / .35) inset; }

    .progress{ height:10px; width:min(1100px, 92vw); margin: 18px auto 28px; background:#1a1a1c; border-radius:12px; overflow:hidden; box-shadow: var(--shadow); }
    .progress .bar{ height:100%; width:0%; background: linear-gradient(90deg, #fff, #777); transition: width .25s ease; }

    /* Settings Panel */
    dialog{ 
      border:none; border-radius:22px; padding:0; background:var(--panel); color:var(--fg);
      width:min(880px, 92vw); box-shadow: var(--shadow);
    }
    dialog::backdrop{ background: rgb(0 0 0 / .45) }
    .panel{ padding:20px 18px 18px; }
    .panel h2{ margin:4px 0 14px; font-size:1.1rem; letter-spacing:.3px; }
    .grid{
      display:grid; grid-template-columns: repeat(5, minmax(0,1fr)); gap:12px;
    }
    .sw{
      background:#141416; border:1px solid #2d2e33; border-radius:16px; padding:10px; display:flex; flex-direction:column; gap:8px; align-items:center; justify-content:center;
    }
    .sw label{ font-size:.85rem; color:var(--muted); font-weight:600 }
    .sw input[type="color"]{ -webkit-appearance:none; appearance:none; width:100%; height:38px; border:none; background:transparent; cursor:pointer; border-radius:12px; overflow:hidden; }
    .row{ display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:12px; flex-wrap:wrap }
    .row .left{ display:flex; gap:10px; align-items:center }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:#17171a; border:1px solid #2b2c31; font-weight:600 }
    .select{ padding:8px 12px; border-radius:12px; background:#17171a; color:var(--fg); border:1px solid #2b2c31; }
    .note{ color:var(--muted); font-size:.9rem }

    /* Small screens */
    @media (max-width: 720px) {
      :root{ --tile-size: min(18vw, 78px); --ring-thickness: 18px }
      .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
      .stripes{ height: 36vh }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand"><span class="dot"></span> Synaesthesia Clock</div>
      <div class="controls">
        <button class="btn" id="modeBtn" title="Switch display mode">Mode: Tiles</button>
        <button class="btn" id="digitsBtn" title="Toggle faint numerals for training">Digits: Off</button>
        <button class="btn" id="settingsBtn" title="Edit your digit colours">Colours</button>
      </div>
    </div>

    <!-- Clock Faces (3 modes) -->
    <div id="clockTiles" class="clock tiles" aria-label="Clock in tiles mode"></div>
    <div id="clockStripes" class="clock stripes" hidden aria-label="Clock in stripes mode"></div>
    <div id="clockRings" class="ring-wrap" hidden aria-label="Clock in rings mode">
      <div class="ring hh" id="ringHours"></div>
      <div class="ring mm" id="ringMinutes"></div>
      <div class="ring ss" id="ringSeconds"></div>
      <div class="legend" id="ringLegend"></div>
    </div>

    <div class="progress" aria-hidden="true"><div class="bar" id="progressBar"></div></div>
  </div>

  <!-- Settings Panel -->
  <dialog id="panel">
    <div class="panel">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:6px;">
        <h2>Digit Colours (0–9)</h2>
        <button class="btn" id="closePanel">Close</button>
      </div>
      <div class="grid" id="swatchGrid"></div>
      <div class="row">
        <div class="left">
          <label class="pill"><input type="checkbox" id="twelve" /> 12‑hour time</label>
          <label class="pill"><input type="checkbox" id="smooth" checked /> Smooth seconds</label>
        </div>
        <div class="left">
          <select id="preset" class="select" title="Pick a preset palette">
            <option value="">Preset palettes…</option>
            <option value="vivid">Vivid</option>
            <option value="pastel">Pastel</option>
            <option value="mono">Mono dark</option>
          </select>
          <button class="btn" id="reset">Reset</button>
          <button class="btn" id="exportBtn">Export</button>
          <button class="btn" id="importBtn">Import</button>
        </div>
      </div>
      <p class="note" style="margin-top:10px">Tip: set these to <em>your</em> number–colour associations. The face uses only colour, so anyone with strong digit–colour mappings can read the time at a glance. Toggle faint numerals for a short training period if helpful.</p>
    </div>
  </dialog>

  <script>
    // ---------- Palette & Settings ----------
    const DEFAULTS = {
      palette: [
        '#ffffff', // 0
        '#ff5a5f', // 1
        '#f7b500', // 2
        '#4bd964', // 3
        '#34c0ff', // 4
        '#9b59ff', // 5
        '#ff9bd3', // 6
        '#ff7e33', // 7
        '#16c6a8', // 8
        '#c6ff34'  // 9
      ],
      twelve: false,
      smooth: true,
      mode: 'tiles', // 'tiles' | 'stripes' | 'rings'
      showDigits: false,
    };

    const PRESETS = {
      vivid: ['#ffffff','#e53935','#ffb300','#43a047','#1e88e5','#8e24aa','#f06292','#fb8c00','#00acc1','#c6ff00'],
      pastel:['#f9f9f9','#f8b4b4','#fde68a','#c7f9cc','#a0d8ff','#d7bdf2','#f7c6e0','#ffd9b5','#b9f4ea','#e8ffb0'],
      mono:  ['#f0f0f0','#c9c9c9','#b8b8b8','#a7a7a7','#969696','#858585','#747474','#636363','#525252','#414141']
    };

    const store = {
      load(){
        try{ return JSON.parse(localStorage.getItem('synClock')) || DEFAULTS }catch{ return DEFAULTS }
      },
      save(data){ localStorage.setItem('synClock', JSON.stringify(data)); }
    };

    let state = store.load();

    // DOM refs
    const tilesEl = document.getElementById('clockTiles');
    const stripesEl = document.getElementById('clockStripes');
    const ringH = document.getElementById('ringHours');
    const ringM = document.getElementById('ringMinutes');
    const ringS = document.getElementById('ringSeconds');
    const ringLegend = document.getElementById('ringLegend');
    const progressBar = document.getElementById('progressBar');

    const modeBtn = document.getElementById('modeBtn');
    const digitsBtn = document.getElementById('digitsBtn');
    const panel = document.getElementById('panel');
    const settingsBtn = document.getElementById('settingsBtn');
    const swatchGrid = document.getElementById('swatchGrid');
    const twelve = document.getElementById('twelve');
    const smooth = document.getElementById('smooth');
    const preset = document.getElementById('preset');

    // Build swatch pickers 0–9
    function buildSwatches(){
      swatchGrid.innerHTML = '';
      for(let i=0;i<10;i++){
        const sw = document.createElement('div'); sw.className = 'sw';
        const lab = document.createElement('label'); lab.textContent = i;
        const inp = document.createElement('input');
        inp.type = 'color'; inp.value = state.palette[i]; inp.dataset.idx = i;
        inp.addEventListener('input', (e)=>{ state.palette[i] = e.target.value; store.save(state); });
        sw.append(lab, inp); swatchGrid.appendChild(sw);
      }
    }

    function applyMode(){
      tilesEl.hidden = state.mode !== 'tiles';
      stripesEl.hidden = state.mode !== 'stripes';
      document.getElementById('clockRings').hidden = state.mode !== 'rings';
      modeBtn.textContent = 'Mode: ' + (state.mode[0].toUpperCase()+state.mode.slice(1));
    }

    function cycleMode(){
      state.mode = state.mode === 'tiles' ? 'stripes' : state.mode === 'stripes' ? 'rings' : 'tiles';
      store.save(state); applyMode();
    }

    // Build tile & stripe DOM once
    function initFaces(){
      // Tiles: 6 squares (H1 H2 M1 M2 S1 S2)
      tilesEl.innerHTML = '';
      for(let i=0;i<6;i++){
        const t = document.createElement('div'); t.className = 'tile';
        const n = document.createElement('div'); n.className = 'tile-num'; n.textContent = '0';
        t.appendChild(n); tilesEl.appendChild(t);
      }

      // Stripes: also 6
      stripesEl.innerHTML = '';
      for(let i=0;i<6;i++){
        const s = document.createElement('div'); s.className = 'stripe';
        stripesEl.appendChild(s);
      }

      updateDigits();
    }

    function getDigits(date){
      let h = date.getHours();
      if(state.twelve) h = (h % 12) || 12;
      const m = date.getMinutes();
      const s = date.getSeconds();
      const pad = n => String(n).padStart(2,'0');
      const [H1,H2] = pad(h);
      const [M1,M2] = pad(m);
      const [S1,S2] = pad(s);
      return [H1,H2,M1,M2,S1,S2].map(d=>parseInt(d,10));
    }

    function colourOf(d){ return state.palette[d] || '#fff'; }

    function lerpColor(a,b,t){ // linear mix in RGB
      const pa = hexToRgb(a), pb = hexToRgb(b);
      const r = Math.round(pa.r + (pb.r - pa.r)*t);
      const g = Math.round(pa.g + (pb.g - pa.g)*t);
      const b2= Math.round(pa.b + (pb.b - pa.b)*t);
      return `rgb(${r} ${g} ${b2})`;
    }
    function hexToRgb(hex){
      const m = hex.trim().replace('#','');
      const v = m.length===3 ? m.split('').map(x=>x+x).join('') : m;
      return { r: parseInt(v.slice(0,2),16), g: parseInt(v.slice(2,4),16), b: parseInt(v.slice(4,6),16) };
    }

    function updateDigits(){
      const now = new Date();
      const ds = getDigits(now);

      // Tiles
      const tileNodes = tilesEl.querySelectorAll('.tile');
      const numNodes  = tilesEl.querySelectorAll('.tile-num');
      ds.forEach((d, i)=>{
        const c = colourOf(d);
        const tile = tileNodes[i];
        tile.style.background = c;
        numNodes[i].textContent = d;
      });
      tilesEl.classList.toggle('show-digits', state.showDigits);

      // Stripes
      const stripeNodes = stripesEl.querySelectorAll('.stripe');
      ds.forEach((d, i)=>{
        stripeNodes[i].style.background = colourOf(d);
      });

      // Rings — each ring blends the two digits of HH/MM/SS
      const [h1,h2,m1,m2,s1,s2] = ds;
      const secondsFrac = state.smooth ? (now.getSeconds() + now.getMilliseconds()/1000)/60 : now.getSeconds()/60;
      const deg = secondsFrac * 360;
      ringH.style.background = `conic-gradient(${colourOf(h1)} 0 180deg, ${colourOf(h2)} 180deg 360deg)`;
      ringM.style.background = `conic-gradient(${colourOf(m1)} 0 180deg, ${colourOf(m2)} 180deg 360deg)`;
      // Seconds ring also shows progress as a wipe from S1 to S2
      ringS.style.background = `conic-gradient(${colourOf(s1)} 0 ${deg}deg, ${colourOf(s2)} ${deg}deg 360deg)`;

      ringLegend.innerHTML = `
        <span class="swatch" style="background:${colourOf(h1)}"></span>H1
        <span class="swatch" style="background:${colourOf(h2)}"></span>H2
        <span style="width:10px"></span>
        <span class="swatch" style="background:${colourOf(m1)}"></span>M1
        <span class="swatch" style="background:${colourOf(m2)}"></span>M2
        <span style="width:10px"></span>
        <span class="swatch" style="background:${colourOf(s1)}"></span>S1
        <span class="swatch" style="background:${colourOf(s2)}"></span>S2
      `;

      // Progress bar: minute progress (smooth using seconds)
      const minutePct = ((now.getSeconds() + now.getMilliseconds()/1000)/60) * 100;
      progressBar.style.width = `${minutePct}%`;
      progressBar.style.background = `linear-gradient(90deg, ${colourOf(s1)}, ${colourOf(s2)})`;
    }

    // Animation loop
    let rafId;
    function loop(){
      updateDigits();
      rafId = requestAnimationFrame(loop);
    }

    // ---------- UI ----------
    buildSwatches(); initFaces(); applyMode(); updateDigits();

    settingsBtn.addEventListener('click', ()=>{ buildSwatches(); twelve.checked=!!state.twelve; smooth.checked=!!state.smooth; panel.showModal(); });
    document.getElementById('closePanel').addEventListener('click', ()=> panel.close());

    twelve.addEventListener('change', (e)=>{ state.twelve = !!e.target.checked; store.save(state); updateDigits(); });
    smooth.addEventListener('change', (e)=>{ state.smooth = !!e.target.checked; store.save(state); });

    document.getElementById('reset').addEventListener('click', ()=>{ state = JSON.parse(JSON.stringify(DEFAULTS)); store.save(state); buildSwatches(); applyMode(); updateDigits(); });

    preset.addEventListener('change', (e)=>{
      const key = e.target.value; if(!key) return; state.palette = PRESETS[key].slice(); store.save(state); buildSwatches(); updateDigits(); e.target.value='';
    });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const blob = new Blob([JSON.stringify(state.palette)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'syn-clock-palette.json'; a.click(); URL.revokeObjectURL(a.href);
    });

    document.getElementById('importBtn').addEventListener('click', ()=>{
      const inp = document.createElement('input'); inp.type='file'; inp.accept='application/json';
      inp.onchange = () => {
        const f = inp.files[0]; if(!f) return;
        const r = new FileReader(); r.onload = () => {
          try{ const pal = JSON.parse(r.result); if(Array.isArray(pal) && pal.length>=10){ state.palette = pal.slice(0,10); store.save(state); buildSwatches(); updateDigits(); } }
          catch{}
        }; r.readAsText(f);
      };
      inp.click();
    });

    modeBtn.addEventListener('click', cycleMode);
    digitsBtn.addEventListener('click', ()=>{ state.showDigits = !state.showDigits; digitsBtn.textContent = `Digits: ${state.showDigits? 'On':'Off'}`; store.save(state); updateDigits(); });

    // Start the loop (60fps when tab is visible; browsers throttle in background)
    loop();

    // Respect reduced motion
    const media = matchMedia('(prefers-reduced-motion: reduce)');
    function onPRM(){ if(media.matches){ cancelAnimationFrame(rafId); setInterval(updateDigits, 250); } }
    media.addEventListener('change', onPRM); onPRM();
  </script>
</body>
</html>
